<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Document</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    /* Only used on mobile (PDF.js path) */
    html, body { margin: 0; background: #000; color: #fff; }
    #app { max-width: 1200px; margin: 0 auto; }
    .page {
      display: block; width: 100%; margin: 0 auto 16px;
      background:#111; box-shadow: 0 0 0 1px #222, 0 6px 24px rgba(0,0,0,.4);
      border-radius: 4px;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <!-- Mobile render container -->
  <div id="app" class="hidden"></div>

  <noscript><meta http-equiv="refresh" content="0; url=JoshuaHalpertPortfolio.pdf"></noscript>

  <script>
    const PDF_URL = "JoshuaHalpertPortfolio.pdf"; // <-- change to your filename

    // Conservative "is mobile" test: user agent + input type + small screens
    const ua = navigator.userAgent || "";
    const uaIsMobile = /Android|iPhone|iPad|iPod|Mobile/i.test(ua);
    const coarse = matchMedia("(pointer: coarse)").matches;
    const narrow = Math.min(window.screen.width, window.screen.height) <= 900;

    // Allow manual override: ?view=mobile or ?view=desktop
    const qs = new URLSearchParams(location.search);
    const force = qs.get("view");
    const isMobile = force === "mobile" ? true :
                     force === "desktop" ? false :
                     (uaIsMobile || coarse || narrow);

    if (!isMobile) {
      // Desktop/PC → open PDF directly in the native viewer (clean & reliable)
      location.replace(PDF_URL);
    } else {
      // Mobile → PDF.js (no toolbar, perfect scaling)
      document.getElementById("app").classList.remove("hidden");

      (async function initMobile() {
        // Load PDF.js dynamically
        await load("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js");
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js";

        try {
          const pdf = await pdfjsLib.getDocument(PDF_URL).promise;
          await renderAllPages(pdf);
          window.addEventListener("resize", debounce(() => renderAllPages(pdf), 120), { passive: true });
        } catch (err) {
          // Fallback: if anything fails, just open the PDF
          console.error(err);
          location.replace(PDF_URL);
        }
      })();

      async function renderAllPages(pdf) {
        const app = document.getElementById("app");
        const width = app.clientWidth || window.innerWidth;
        const DPR = Math.min(window.devicePixelRatio || 1, 2); // cap for performance

        // Ensure the right number of canvases exist
        while (app.children.length < pdf.numPages) {
          const c = document.createElement("canvas");
          c.className = "page";
          app.appendChild(c);
        }
        while (app.children.length > pdf.numPages) {
          app.removeChild(app.lastChild);
        }

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const base = page.getViewport({ scale: 1 });
          const scale = width / base.width;
          const vp = page.getViewport({ scale });

          const canvas = app.children[i - 1];
          canvas.style.width = vp.width + "px";
          canvas.style.height = vp.height + "px";
          canvas.width  = Math.floor(vp.width  * DPR);
          canvas.height = Math.floor(vp.height * DPR);

          const ctx = canvas.getContext("2d", { alpha: false });
          ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
          await page.render({ canvasContext: ctx, viewport: vp }).promise;
        }
      }

      function load(src) {
        return new Promise((res, rej) => {
          const s = document.createElement("script");
          s.src = src; s.onload = res; s.onerror = rej;
          document.head.appendChild(s);
        });
      }

      function debounce(fn, ms) {
        let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
      }
    }
  </script>
</body>
</html>
